{% include 'header.html' %}
{% block body %}

<div>
    <h2>Estoque de Toners - Saída</h2>
    <form class="form-inline" method="POST" action="{{ url_for('saida') }}">
        <table id="equipamentos" class="table">
            <thead>
                <tr>
                    <th>Modelo</th>
                    <th>Condição troca</th>
                    <th>Serial Impressora</th>
                    <th>Serial Toner</th>
                    <th>Número Chamado</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="tabela-linhas">
                <tr class="linha">
                    <td>
                        <select name="equipamento_toner[]" class="form-control">
                            {% for equipamento in equipamentos %}
                            <option value="{{ equipamento[0] }}">{{ equipamento[0] }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <select name="status_toner[]" class="form-control">
                            {% for stat in status %}
                            <option value="{{ stat[0] }}">{{ stat[0] }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <select name="serie_equipamento[]" class="form-control">
                            {% for serie in series %}
                            <option value="{{ serie[0] }}">{{ serie[0] }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input type="text" required name="serial_toner[]" class="form-control">
                    </td>
                    <td>
                        <input type="text" required name="num_chamado[]" class="form-control">
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeLinha(this)">-</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <button type="button" class="btn btn-primary" onclick="addLinha()">Adicionar Linha</button>
        <button type="submit" class="btn btn-success">Gravar</button>
    </form>
</div>

<script>
    function addLinha() {
        var tabela = document.getElementById('tabela-linhas');
        var linha = document.querySelector('.linha');
        var novaLinha = linha.cloneNode(true);
        
        // Limpar os valores dos campos da nova linha
        novaLinha.querySelectorAll('input').forEach(input => input.value = '');
        novaLinha.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
        
        tabela.appendChild(novaLinha);
    }

    function removeLinha(button) {
        var tabela = document.getElementById('tabela-linhas');
        var linhas = tabela.querySelectorAll('.linha');
        
        if (linhas.length > 1) {
            tabela.removeChild(button.closest('tr'));
        } else {
            alert('Pelo menos uma linha deve permanecer.');
        }
    }
</script>

{% endblock %}
